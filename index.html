<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Expansion Manager - Painel de Risco Climático</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <h1><i class="fas fa-city"></i> City Expansion Manager</h1>
                <div class="header-controls">
                    <button id="refreshBtn" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados
                    </button>
                    <button id="settingsBtn" class="btn btn-secondary">
                        <i class="fas fa-cog"></i> Configurações
                    </button>
                    <button id="aiSidebarBtn" class="btn btn-secondary">
                        <i class="fas fa-robot"></i> IA
                    </button>
                </div>
            </div>
        </header>

        <!-- Alert Banner -->
        <div id="alertBanner" class="alert-banner hidden">
            <div class="alert-content">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="alertMessage"></span>
                <button id="closeAlert" class="alert-close">&times;</button>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <main class="dashboard-main">
            <!-- Cartões de Visão Geral do Clima -->
            <section class="weather-overview">
                <div class="weather-card">
                    <div class="card-header">
                        <i class="fas fa-thermometer-half"></i>
                        <h3>Temperatura</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-value" id="temperature">--°C</div>
                        <div class="metric-trend" id="tempTrend">--</div>
                    </div>
                </div>

                <div class="weather-card">
                    <div class="card-header">
                        <i class="fas fa-tint"></i>
                        <h3>Umidade</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-value" id="humidity">--%</div>
                        <div class="metric-trend" id="humidityTrend">--</div>
                    </div>
                </div>

                <div class="weather-card">
                    <div class="card-header">
                        <i class="fas fa-wind"></i>
                        <h3>Vento</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-value" id="windSpeed">-- km/h</div>
                        <div class="metric-trend" id="windTrend">--</div>
                    </div>
                </div>

                <div class="weather-card">
                    <div class="card-header">
                        <i class="fas fa-lungs"></i>
                        <h3>Qualidade do Ar</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-value" id="airQuality">-- AQI</div>
                        <div class="metric-trend" id="airQualityTrend">--</div>
                    </div>
                </div>

                <div class="weather-card">
                    <div class="card-header">
                        <i class="fas fa-fire"></i>
                        <h3>Chance de Incêndio</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-value" id="fireRisk">--%</div>
                        <div class="metric-trend" id="fireRiskTrend">--</div>
                        <div class="risk-level">Risco: <span id="riskIndicator">--</span></div>
                    </div>
                </div>
            </section>

            <!-- Seção do Mapa -->
            <section class="map-section">
                <div class="section-header">
                    <h2><i class="fas fa-map-marked-alt"></i> Mapa da Cidade & Avaliação de Risco</h2>
                    <div class="map-controls">
                        <button id="locateBtn" class="btn btn-small">
                            <i class="fas fa-crosshairs"></i> Minha Localização
                        </button>
                        <button id="heatmapToggle" class="btn btn-small">
                            <i class="fas fa-fire"></i> Mapa de Calor
                        </button>
                    </div>
                </div>
                <div id="map" class="map-container"></div>
            </section>

            <!-- Painel de Avaliação de Risco -->
            <section class="risk-panel">
                <div class="section-header">
                    <h2><i class="fas fa-shield-alt"></i> Avaliação de Risco</h2>
                </div>
                <div class="risk-content">
                    <div class="risk-level" id="riskLevel">
                        <div class="risk-indicator low">
                            <i class="fas fa-check-circle"></i>
                            <span>Risco Baixo</span>
                        </div>
                    </div>
                    <div class="risk-factors">
                        <div class="risk-factor">
                            <span class="factor-label">Risco Climático:</span>
                            <span class="factor-value" id="weatherRisk">--</span>
                        </div>
                        <div class="risk-factor">
                            <span class="factor-label">Risco de Qualidade do Ar:</span>
                            <span class="factor-value" id="airRisk">--</span>
                        </div>
                        <div class="risk-factor">
                            <span class="factor-label">Densidade Populacional:</span>
                            <span class="factor-value" id="populationRisk">--</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Previsão do Tempo -->
            <section class="forecast-section">
                <div class="section-header">
                    <h2><i class="fas fa-calendar-alt"></i> Previsão de 7 Dias</h2>
                </div>
                <div class="forecast-grid" id="forecastGrid">
                    <!-- Forecast items will be populated by JavaScript -->
                </div>
            </section>

            <!-- Histórico Climático -->
            <section class="history-section">
                <div class="section-header">
                    <h2><i class="fas fa-history"></i> Histórico Climático (7 dias)</h2>
                </div>
                <div class="history-list" id="historyList">
                    <!-- Histórico será preenchido via JavaScript -->
                </div>
            </section>

            

            <!-- Controles do Mapa de Calor -->
            <section class="heatmap-controls">
                <div class="section-header">
                    <h2><i class="fas fa-fire"></i> Visualização de Mapa de Calor</h2>
                </div>
                <div class="heatmap-options">
                    <div class="option-group">
                        <label for="heatmapType">Tipo de Mapa de Calor:</label>
                        <select id="heatmapType">
                            <option value="population">Densidade Populacional</option>
                            <option value="temperature">Temperatura</option>
                            <option value="airQuality">Qualidade do Ar</option>
                            <option value="risk">Avaliação de Risco</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="heatmapIntensity">Intensidade:</label>
                        <input type="range" id="heatmapIntensity" min="0" max="100" value="50">
                        <span id="intensityValue">50%</span>
                    </div>
                </div>
            </section>
        </main>

        <!-- Sidebar da IA -->
        <div id="aiSidebarOverlay" class="sidebar-overlay hidden"></div>
        <aside id="aiSidebar" class="sidebar hidden">
            <div class="sidebar-header">
                <h3><i class="fas fa-robot"></i> Assistente de IA</h3>
                <button id="closeAiSidebar" class="sidebar-close">&times;</button>
            </div>
            <div class="sidebar-body">
                <div class="ai-controls">
                    <input id="aiAreaName" class="ai-input" type="text" placeholder="Nome da área (opcional)">
                    <textarea id="aiQuestion" class="ai-textarea" rows="4" placeholder="Faça uma pergunta sobre construção, risco ambiental, poluição, deslizamento, calor urbano..."></textarea>
                    <button id="aiAnalyzeBtn" class="btn btn-primary"><i class="fas fa-magnifying-glass-chart"></i> Analisar</button>
                </div>
                <div id="aiResult" class="ai-result"></div>
            </div>
        </aside>

        <!-- Modal de Configurações -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Configurações</h3>
                    <button id="closeSettings" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label for="weatherAPI">Provedor de API de Clima:</label>
                        <select id="weatherAPI">
                            <option value="tomorrow_openaq">Tomorrow.io + OpenAQ (Clima premium + AQI real)</option>
                            <option value="tomorrow">Tomorrow.io (100 chamadas/dia, dados premium)</option>
                            <option value="openmeteo">Open-Meteo (Grátis, sem API Key)</option>
                            <option value="openweathermap">OpenWeatherMap (1000 chamadas/dia)</option>
                            <option value="weatherapi">WeatherAPI.com (1M chamadas/mês)</option>
                            <option value="weatherbit">Weatherbit (500 chamadas/dia)</option>
                        </select>
                        <small>Escolha seu provedor preferido de dados climáticos</small>
                    </div>
                    <div class="setting-group">
                        <label for="apiKey">Chave da API:</label>
                        <input type="password" id="apiKey" placeholder="Insira sua chave da API (se necessário)">
                        <small id="apiKeyHelp">Chave de API não é necessária para Open-Meteo</small>
                    </div>
                    <div class="setting-group">
                        <label for="tomorrowHumidityKey">Tomorrow.io (Umidade) - opcional:</label>
                        <input type="password" id="tomorrowHumidityKey" placeholder="Chave da API do Tomorrow.io para umidade (opcional)">
                        <small>Se informado, a umidade será obtida do Tomorrow.io, independente do provedor principal.</small>
                    </div>
                    <div class="setting-group">
                        <label for="useOpenAQ">Usar OpenAQ para Qualidade do Ar:</label>
                        <input type="checkbox" id="useOpenAQ" checked>
                        <small>Obtenha dados em tempo real de qualidade do ar do OpenAQ (grátis, sem chave de API)</small>
                    </div>
                    <div class="setting-group">
                        <label for="alertThreshold">Nível de Alerta:</label>
                        <select id="alertThreshold">
                            <option value="low">Baixo (Conservador)</option>
                            <option value="medium" selected>Médio (Equilibrado)</option>
                            <option value="high">Alto (Sensível)</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="refreshInterval">Intervalo de Atualização Automática:</label>
                        <select id="refreshInterval">
                            <option value="30000">30 segundos</option>
                            <option value="60000" selected>1 minuto</option>
                            <option value="300000">5 minutos</option>
                            <option value="600000">10 minutos</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveSettings" class="btn btn-primary">Salvar</button>
                    <button id="cancelSettings" class="btn btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="main.js"></script>
</body>
</html>
